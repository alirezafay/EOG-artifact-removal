clc; close all; clear all; 
sig = load('pure.mat');
sig2 = load('contaminated.mat');
pure1 = sig.pure;
contaminated = sig2.contaminated;
z = load('y_DSS.csv'); %whitened dimensional reduced data
D = load('Dmatrix_DSS.csv');
time_EOG = [1.5 2.925; 16 16.5; 21.9 22.5];
tt = time_EOG *200; % for defining sample numbers 
w1 = [0.609866648422558;0.617666389588455;0.859442305646212;0.805489424529686;0.576721515614685;0.182922469414914;0.239932010568717;0.886511933076101;0.0286741524641061;0.489901388512224;0.167927145682257;0.978680649641159;0.712694471678914;0.500471624154843;0.471088374541939;0.0596188675796392;0.681971904149063;0.0424311375007417;0.0714454646006424];
w2 = [0.231365567839496;0.150161436812082;0.302204646150232;0.451444407851259;0.234572889799282;0.109393823159206;3.08950011577422e-05;0.248458391785612;-0.107384943951497;0.0915694449363192;-0.0662460124385309;0.442607609492472;0.210910188865775;0.407994407013815;0.238240998045168;0.0436026008884075;0.0644844761161504;-0.0398395941671259;0.0671887522084880];
w3 = [0.137552045110488;0.0227424979188206;0.283844482020382;0.465798469387099;0.220547437175097;0.0597792759399269;-0.102539279161827;0.150570617811479;-0.132610856338346;0.0814087065207312;-0.106759026080727;0.373406503106787;0.186131497900955;0.503322511293393;0.261253596396886;0.0967231097183146;-0.0945810478327023;-0.132358156319546;0.174732067665915];
w4 = [-0.0826265592789025;-0.231346848440179;0.384780558720851;0.323275884037200;0.293303408980231;-0.0194614240742468;-0.193084368482306;0.0146977540220916;-0.129783142804213;0.0829348623265331;-0.0707610898634439;0.221463788823460;0.247858947504422;0.437518957199664;0.247855693495473;0.151987925870445;-0.119727640355182;-0.202827096648500;0.304214515527430];
w5 = [-0.304701461711621;-0.457239735062671;0.455637852885020;0.0609070048222478;0.361595497514467;-0.0608667607319844;-0.180007410266584;-0.124957687206534;-0.109807561749114;0.0478000954064062;0.0102343866321676;0.0338843352297610;0.287676514871734;0.191503685089405;0.154478644171122;0.139321822129474;-0.00930115711913380;-0.176535725113227;0.307811135893514];
S1 = transpose(w4) * z;
S1_plus = zeros(1,5601);
S1_plus(1,300:585)   = S1(1,300:585); % Setting the Off Values Of EOG activities to zero
S1_plus(1,3200:3300) = S1(1,3200:3300);
S1_plus(1,4380:4500) = S1(1,4380:4500);
w1_plus = z * transpose(S1_plus); %w1+
w1_plus1 = w1_plus/norm(w1_plus); %normalized w1+
S1_final = transpose(w1_plus1)*z;
z = w1_plus * S1_final;
x_EOG_noised = pinv(D)*z;
x_denoised = contaminated - x_EOG_noised; 
RM = RRMSE(pure1,x_denoised);
load('Electrodes') ;
offset = max(abs(x_denoised(:))) ;
 feq = 200;
 ElecName = Electrodes.labels ;
disp_eeg(x_denoised,offset,feq,ElecName);
function [R] = RRMSE(x_org,x_den)
    sum1 = 0;
    sum2 = 0;
    for i=1:length(x_org(:,1))
        a = (x_org(i,:)-x_den(i,:)).^2;
        b = x_org(i,:).^2;
        sum1 = sum1 + sum(a);
        sum2 = sum2 + sum(b);
    end
    R = sqrt(sum1/sum2)/500;
end